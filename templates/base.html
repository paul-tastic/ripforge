<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RipForge{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî•</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block head %}{% endblock %}
</head>
<body>
    <nav class="sidebar">
        <div class="logo">
            <span class="logo-icon">üî•</span>
            <span class="logo-text">RipForge</span>
        </div>
        <ul class="nav-links">
            <li><a href="/" class="{% if request.endpoint == 'main.index' %}active{% endif %}">
                <span class="nav-icon">üìÄ</span> Dashboard
            </a></li>
            <li><a href="/history" class="{% if request.endpoint == 'main.history' %}active{% endif %}">
                <span class="nav-icon">üìú</span> History
            </a></li>
            <li><a href="/library" class="{% if request.endpoint == 'main.library' %}active{% endif %}">
                <span class="nav-icon">üìÅ</span> Library
            </a></li>
            <li><a href="/failures" class="{% if request.endpoint == 'main.failures' %}active{% endif %}">
                <span class="nav-icon">‚ö†Ô∏è</span> Failures
            </a></li>
            <li><a href="/notifications" class="{% if request.endpoint == 'main.notifications' %}active{% endif %}">
                <span class="nav-icon">üîî</span> Notifications
            </a></li>
            <li><a href="/settings" class="{% if request.endpoint == 'main.settings' %}active{% endif %}">
                <span class="nav-icon">‚öôÔ∏è</span> Settings
            </a></li>
        </ul>

        <!-- Quick Stats in Sidebar -->
        <div class="sidebar-stats">
            <div class="sidebar-stats-header">Library</div>
            <div class="sidebar-stat-row">
                <span class="stat-label">Movies</span>
                <span class="stat-value" id="stat-movies">0</span>
            </div>
            <div class="sidebar-stat-row">
                <span class="stat-label">TV Shows</span>
                <span class="stat-value" id="stat-tv">0</span>
            </div>
            <div class="sidebar-stat-row">
                <span class="stat-label">Total Size</span>
                <span class="stat-value" id="stat-size">--</span>
            </div>
            <div class="sidebar-stat-row clickable" id="errors-row" onclick="showErrorsModal()" title="Click to view error details">
                <span class="stat-label">Errors</span>
                <span class="stat-value error" id="stat-errors">0</span>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="version" id="sidebar-version">v...</div>
        </div>
    </nav>

    <main class="content">
        <header class="topbar">
            <h1>{% block page_title %}Dashboard{% endblock %}</h1>
            <div class="topbar-status">
                <span class="status-indicator" id="drive-status">‚óè Drive Ready</span>
            </div>
        </header>

        <div class="main-content">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Errors Modal -->
    <div class="modal-overlay" id="errors-modal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Rip Errors</h3>
                <button class="modal-close" onclick="closeErrorsModal()">&times;</button>
            </div>
            <div class="modal-body" id="errors-modal-body">
                <p>Loading...</p>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
    function showErrorsModal() {
        const modal = document.getElementById('errors-modal');
        const body = document.getElementById('errors-modal-body');
        modal.style.display = 'flex';
        body.innerHTML = '<p>Loading...</p>';

        fetch('/api/stats/errors')
            .then(r => r.json())
            .then(data => {
                if (data.errors.length === 0) {
                    body.innerHTML = '<p style="color: var(--text-muted);">No errors recorded.</p>';
                    return;
                }
                let html = '<div class="errors-list">';
                data.errors.forEach(err => {
                    html += `<div class="error-item">
                        <span class="error-time">${err.timestamp}</span>
                        <span class="error-msg">${err.message}</span>
                    </div>`;
                });
                html += '</div>';
                body.innerHTML = html;
            })
            .catch(() => {
                body.innerHTML = '<p style="color: var(--error);">Failed to load errors.</p>';
            });
    }

    function closeErrorsModal() {
        document.getElementById('errors-modal').style.display = 'none';
    }

    // Close modal on overlay click
    document.getElementById('errors-modal').addEventListener('click', function(e) {
        if (e.target === this) closeErrorsModal();
    });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
