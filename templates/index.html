{% extends "base.html" %}

{% block title %}RipForge - Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Current Rip Status -->
    <section class="card rip-status">
        <h2>Current Status</h2>
        <div class="status-display" id="current-status">
            <div class="status-icon idle">üìÄ</div>
            <div class="status-text">
                <div class="status-title">Ready</div>
                <div class="status-subtitle">Insert a disc to begin</div>
            </div>
        </div>
        <div class="progress-container" id="progress-container" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-text">0%</div>
        </div>
    </section>

    <!-- Quick Stats -->
    <section class="card stats">
        <h2>Quick Stats</h2>
        <div class="stats-grid">
            <div class="stat">
                <div class="stat-value" id="stat-today">0</div>
                <div class="stat-label">Ripped Today</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-week">0</div>
                <div class="stat-label">This Week</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-total">0</div>
                <div class="stat-label">All Time</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-errors">0</div>
                <div class="stat-label">Errors</div>
            </div>
        </div>
    </section>

    <!-- Drive Info -->
    <section class="card drive-info">
        <h2>Optical Drive</h2>
        <div class="drive-details" id="drive-details">
            <div class="drive-row">
                <span class="label">Device:</span>
                <span class="value" id="drive-device">Scanning...</span>
            </div>
            <div class="drive-row">
                <span class="label">Model:</span>
                <span class="value" id="drive-model">-</span>
            </div>
            <div class="drive-row">
                <span class="label">Status:</span>
                <span class="value" id="drive-disc-status">No disc</span>
            </div>
        </div>
    </section>

    <!-- Integrations Status -->
    <section class="card integrations">
        <h2>Integrations</h2>
        <div class="integration-list" id="integration-list">
            <div class="integration">
                <span class="integration-name">Radarr</span>
                <span class="integration-status" id="int-radarr">‚óè</span>
            </div>
            <div class="integration">
                <span class="integration-name">Sonarr</span>
                <span class="integration-status" id="int-sonarr">‚óè</span>
            </div>
            <div class="integration">
                <span class="integration-name">Overseerr</span>
                <span class="integration-status" id="int-overseerr">‚óè</span>
            </div>
            <div class="integration">
                <span class="integration-name">Plex</span>
                <span class="integration-status" id="int-plex">‚óè</span>
            </div>
        </div>
    </section>

    <!-- Recent Activity -->
    <section class="card activity">
        <h2>Recent Activity</h2>
        <div class="activity-list" id="activity-list">
            <div class="activity-item">
                <span class="activity-time">--:--</span>
                <span class="activity-text">No recent activity</span>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Load status on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadStatus();
        // Refresh every 5 seconds
        setInterval(loadStatus, 5000);
    });

    function loadStatus() {
        fetch('/api/status')
            .then(r => r.json())
            .then(data => {
                // Update drive info
                if (data.drives && data.drives.length > 0) {
                    document.getElementById('drive-device').textContent = data.drives[0].device;
                    document.getElementById('drive-model').textContent = data.drives[0].model;
                }

                // Update integration status
                for (const [service, status] of Object.entries(data.integrations)) {
                    const el = document.getElementById('int-' + service);
                    if (el) {
                        if (!status.enabled) {
                            el.className = 'integration-status disabled';
                            el.textContent = '‚óã';
                        } else if (status.connected) {
                            el.className = 'integration-status connected';
                            el.textContent = '‚óè';
                        } else {
                            el.className = 'integration-status error';
                            el.textContent = '‚óè';
                        }
                    }
                }
            })
            .catch(err => console.error('Error loading status:', err));
    }
</script>
{% endblock %}
